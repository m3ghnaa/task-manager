<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Task Manager</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <script src="https://unpkg.com/@heroicons/react/outline"></script>
    </head>
<body>
    <%- include('layout') %>

<h1 class="text-2xl font-semibold mb-4">Task List</h1>

<a href="/tasks/new" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">âž• Add Task</a>

<ul class="mt-4 space-y-3">
    <% tasks.forEach(task => { 
        let isOverdue = task.dueDate && new Date(task.dueDate) < new Date() && !task.completed;
    %>
        <li class="p-4 bg-white shadow-md rounded-md flex justify-between items-center">
            <span class="<%= task.completed ? 'line-through text-gray-400' : 'text-gray-800' %>">
                <%= task.title %>
            </span>
            <% if (task.dueDate) { %>
                <p class="text-sm text-gray-600">
                    Due: <%= new Date(task.dueDate).toLocaleDateString() %>
                </p>
            <% } %>
            <div class="flex space-x-3">
              
                <a href="/tasks/edit/<%= task._id %>" class="text-blue-500 hover:text-blue-700">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 3.487a2.25 2.25 0 0 1 3.183 3.182L6.75 19.964 2.25 21.75l1.786-4.5 13.826-13.763Z"/>
                    </svg>
                </a>

                <form action="/tasks/<%= task._id %>?_method=PUT" method="POST">
                    <button class="text-green-500 hover:text-green-700">
                        <% if (!task.completed) { %>

                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5"/>
                            </svg>
                        <% } else { %>

                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75L9 8.25m0 0l4.5 4.5m-4.5-4.5v12"/>
                            </svg>
                        <% } %>
                    </button>
                </form>


<form action="/tasks/<%= task._id %>?_method=DELETE" method="POST" onsubmit="return confirmDelete()">
    <button class="text-red-500 hover:text-red-700">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/>
        </svg>
    </button>
</form>

                
            </div>
        </li>
    <% }) %>
</ul>

<script>
    function confirmDelete() {
        return confirm("Are you sure you want to delete this task? This action cannot be undone.");
    }
</script>

</body>
</html>
